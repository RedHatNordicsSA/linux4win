---
- name: ensure realmd and all deps are installed
  yum:
    name: "{{ packages }}"
  vars:
    packages:
    - realmd
    - oddjob
    - oddjob-mkhomedir
    - sssd
    - adcli
    - samba-common-tools
- name: make sure line 'dns=none' is set in /etc/NetworkManager/NetworkManager.conf
  ini_file:
    path: /etc/NetworkManager/NetworkManager.conf
    state: present
    no_extra_spaces: yes
    section: main
    option: dns
    value: none
    owner: root
    group: root
    mode: 0644
    backup: yes
- name: Add win domain controller as dns server
  lineinfile:
    path: /etc/resolv.conf
    regexp: '^# Generated by NetworkManager'
    line: 'nameserver 10.0.1.6'
- name: Restart service NetworkManager to pickup new dns
  service:
    name: NetworkManager
    state: restarted