---
- name: Prepare for lab5
  gather_facts: no
  vars:
    - ansible_python_interpreter: /usr/libexec/platform-python
  tasks:
  - name: ensure realmd and all deps are installed
    yum:
      name: "{{ packages }}"
    vars:
      packages:
      - realmd
      - oddjob
      - oddjob-mkhomedir
      - sssd
      - adcli
      - samba-common-tools
  - name: make sure line 'dns=none' is set in /etc/NetworkManager/NetworkManager.conf
    ini_file:
      path: /etc/NetworkManager/NetworkManager.conf
      state: present
      no_extra_spaces: yes
      section: main
      option: dns
      value: none
      owner: root
      group: root
      mode: 0644
      backup: yes
    notify:
      - reload NetworkManager
  - name: Add win domain controller as dns server
    lineinfile:
      path: /etc/resolv.conf
      regexp: '^# Generated by NetworkManager'
      line: 'nameserver 10.0.1.6'
  handlers:
  - name: reload NetworkManager
  service:
    name: NetworkManager
    state: reloaded

